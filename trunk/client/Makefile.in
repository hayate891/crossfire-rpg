VERSION = crossfire-client-@VERSION@
MKDIR = @MKDIR@
CP = @CP@
TAR = @TAR@
RM = @RM@
TARGET = @TARGET@
CFLAGS = @CFLAGS@ @CPPFLAGS@ -I.
LDFLAGS = @LDFLAGS@
CC = @CC@
LIBS = @LIBS@ @LIBXPM_LIB@ 
INSTALL = @INSTALL@
DEPEND = @DEPEND@
PERL = @PERL@
SOUND_DIR = @SOUNDDIR@
DMALLOC_LIB = @DMALLOC_LIB@
AR = @AR@
RANLIB = @RANLIB@

SUBDIRS = @SUBDIRS@

# Put all them here - by default, SUBDIRS will change depending on libraries
# and other stuff detected.  ALLBSUBDIRS is used for the archive creation.
ALLSUBDIRS = common gtk gnome sound-src x11

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
mandir=@mandir@/man1
soundlistdir=@sysconfdir@/sound/events
desktopdir=@prefix@/share/gnome/apps/Games
pixmapsdir=@prefix@/share/pixmaps

EXTRA_DIST = \
	CHANGES			\
	COPYING			\
	License			\
	Makefile.in		\
	NOTES			\
	README			\
	TODO			\
	aclocal.m4		\
	configure		\
	configure.in		\
	crossfire-client.spec


PIXMAPS = \
	pixmaps/all.xpm		\
	pixmaps/applied.xpm	\
	pixmaps/bg.xpm		\
	pixmaps/close.xpm	\
	pixmaps/coin.xpm	\
	pixmaps/crossfiretitle.xpm	\
	pixmaps/cursed.xpm	\
	pixmaps/damned.xpm	\
	pixmaps/dot.xpm		\
	pixmaps/hand.xpm	\
	pixmaps/hand2.xpm	\
	pixmaps/lock.xpm	\
	pixmaps/locked.xpm	\
	pixmaps/mag.xpm		\
	pixmaps/magic.xpm	\
	pixmaps/nonmag.xpm	\
	pixmaps/question.111	\
	pixmaps/question.xpm	\
	pixmaps/shield.png	\
	pixmaps/skull.xpm	\
	pixmaps/stipple.111	\
	pixmaps/stipple.112	\
	pixmaps/test.xpm	\
	pixmaps/unlock.xpm	\
	pixmaps/unpaid.xpm	

HELP= \
	help/about.h		\
	help/chelp.h		\
	help/shelp.h

UTILS = \
	utils/config.guess	\
	utils/config.sub	\
	utils/deftoheader.pl	\
	utils/install-sh	\
	utils/mdk.sh		\
	utils/missing		\
	utils/mkinstalldirs


all:
	@for dir in $(SUBDIRS); \
	    do \
	    echo "making all in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' all; ) \
	done;


depend:
	@for dir in $(SUBDIRS); \
	    do \
	    echo "making depend in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' depend; ) \
	done;

clean:
	@for dir in $(SUBDIRS); \
	    do \
	    echo "making clean in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' clean; ) \
	done;

distclean:
	$(RM) -f Makefile Makefile.bak config.cache config.log config.status
	@for dir in $(SUBDIRS); \
	    do \
	    echo "making distclean in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' distclean; ) \
	done;

proto:
	@for dir in $(SUBDIRS); \
	    do \
	    echo "making proto in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' proto; ) \
	done;

archive:
	if [ -d /tmp/$(VERSION) ]; then $(RM) -rf /tmp/$(VERSION); fi
	$(MKDIR) /tmp/$(VERSION) /tmp/$(VERSION)/utils /tmp/$(VERSION)/help /tmp/$(VERSION)/pixmaps
	$(CP) $(EXTRA_DIST) /tmp/$(VERSION)
	$(CP) $(PIXMAPS) /tmp/$(VERSION)/pixmaps
	$(CP) $(HELP) /tmp/$(VERSION)/help
	$(CP) $(UTILS) /tmp/$(VERSION)/utils
	@for dir in $(ALLSUBDIRS); \
	    do \
	    echo "making archive in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' archive; ) \
	done;
	(cd /tmp; $(RM) $(VERSION).tgz; \
		$(TAR) cvfhz $(VERSION).tar.gz $(VERSION) )
	$(CP) /tmp/$(VERSION).tar.gz ../
	$(RM) -rf /tmp/$(VERSION) /tmp/$(VERSION).tar.gz

install:
	@for dir in $(SUBDIRS); \
	    do \
	    echo "making install in $$dir..."; \
	    (cd $$dir;  $(MAKE) $(MFLAGS) 'MFLAGS=$(MFLAGS)' install; ) \
	done;
