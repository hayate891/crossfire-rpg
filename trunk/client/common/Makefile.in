VERSION = crossfire-client-@VERSION@
MKDIR = @MKDIR@
CP = @CP@
TAR = @TAR@
RM = @RM@
CFLAGS = @CFLAGS@ @CPPFLAGS@ -I.
LDFLAGS = @LDFLAGS@
CC = @CC@
LIBS = @LIBS@
INSTALL = @INSTALL@
DEPEND = @DEPEND@
PERL = @PERL@
DMALLOC_LIB = @DMALLOC_LIB@
AR = @AR@
RANLIB = @RANLIB@


prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@

HEADERS= \
	cconfig.h		\
	client.h		\
	client-types.h		\
	external.h		\
	item.h			\
	item-types.h		\
        newclient.h		\
	proto.h			\
	script.h	

SOURCES = \
	client.c		\
	commands.c		\
	image.c			\
	init.c			\
	item.c			\
	metaserver.c		\
	misc.c			\
	newsocket.c		\
	player.c		\
	script.c

OBJECTS = $(SOURCES:.c=.o)

EXTRA_DIST = \
	config.h.in		\
	def-keys		\
	def-keys.h		\
	item-types		\
	items.pl		\
	Makefile.in

all: def-keys.h rcs-id.h item-types.h libcfclient.a

libcfclient.a: $(OBJECTS)
	$(RM) -f $@
	$(AR) $(ARFLAGS) $@ $(OBJECTS)
	$(RANLIB) $@

proto:
	cproto -e -o proto.h -DCPROTO -DCFCLIENT $(INCLUDES) -I. $(SOURCES)
	chmod 664 proto.h

item-types.h: item-types
	$(PERL) items.pl

def-keys.h: def-keys
	utils/mdk.sh

rcs-id.h: $(SOURCES)
	@echo "Generating rcs-id.h"
	@echo '/* Do not edit, generated file*/' > rcs-id.h
	@echo '#define HAS_COMMON_RCSID' >> rcs-id.h
	@echo 'char* common_rcsid[]={' >> rcs-id.h
	@echo '"     rcs-id generated' `date` '",' >> rcs-id.h
	@for i in  $(SOURCES); do A='"';A=$${A}`ident $$i | grep '\$$Id.*\$$' | head -n 1`; A=$${A}'",' ;echo "$$A" >> rcs-id.h; done
	@echo 'NULL};' >> rcs-id.h
.c.o: rcs-id.h
	$(CC) $(CFLAGS) $(INCLUDES) -c $*.c


archive:
	$(MKDIR) -p /tmp/$(VERSION)/common
	$(CP) $(HEADERS) $(SOURCES) $(EXTRA_DIST) /tmp/$(VERSION)/common

clean::
	$(RM) -f $(OBJECTS)
	$(RM) -f rcs-id.h

distclean::
	$(MAKE) clean
	$(RM) -f libcfclient.a Makefile

install:
	echo "Nothing to be done for make install"

depend:
	$(DEPEND) $(DEPENDFLAGS) -- $(CFLAGS) $(INCLUDES)  -- $(SOURCES)
