VERSION = crossfire-client-@VERSION@
MKDIR = @MKDIR@
CP = @CP@
TAR = @TAR@
RM = @RM@
TARGET = @TARGET@
CFLAGS = @CFLAGS@ @CPPFLAGS@ -I.
LDFLAGS = @LDFLAGS@
CC = @CC@
LIBS = @LIBS@ @LIBXPM_LIB@ 
INSTALL = @INSTALL@
DEPEND = @DEPEND@
PERL = @PERL@
SOUND_DIR = @SOUNDDIR@
DMALLOC_LIB = @DMALLOC_LIB@
AR = @AR@
RANLIB = @RANLIB@
INCLUDES = -I.. -I../common -I.
SND_LIBS= @SND_LIBS@
ALSA9_LIBS = @ALSA9_LIBS@
SOUND_TARGETS=@SOUND_TARGETS@

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=${DESTDIR}@bindir@
mandir=${DESTDIR}@mandir@/man1
soundlistdir=${DESTDIR}@sysconfdir@/sound/events
desktopdir=${DESTDIR}@prefix@/share/gnome/apps/Games
pixmapsdir=${DESTDIR}@prefix@/share/pixmaps

HEADERS= \
	soundsdef.h

SOURCES = \
	cfsndserv.c


EXTRA_DIST = \
	Makefile.in		\
	alsa9.c			\
	common.c		\
	sounds			\
	sounds.dist


SND_OBJS= $(SOURCES:.c=.o)


all:  soundsdef.h cfsndserv $(SOUND_TARGETS)

proto:
	echo "Nothing to do for proto"

sounds: sounds.dist Makefile
	$(PERL) -p -e s#/usr/local/lib/sounds#$(SOUND_DIR)# sounds.dist > sounds

soundsdef.h: sounds
	$(PERL) ../utils/deftoheader.pl sounds soundsdef.h def_sounds

.c.o:
	$(CC) $(CFLAGS) $(INCLUDES) -c $*.c

cfsndserv: $(SND_OBJS) soundsdef.h
	$(CC) -o cfsndserv $(SND_OBJS) $(LDFLAGS) $(SND_LIBS) $(DMALLOC_LIB)

cfsndserv-alsa9: common.c alsa9.o soundsdef.h
	$(CC) -o cfsndserv-alsa9 $(LDFLAGS) alsa9.o $(ALSA9_LIBS) $(DMALLOC_LIB)

archive:
	$(MKDIR) /tmp/$(VERSION)/sound-src
	$(CP) $(HEADERS) $(SOURCES) $(EXTRA_DIST) /tmp/$(VERSION)/sound-src

clean::
	$(RM) -f $(SND_OBJS)

distclean::
	$(MAKE) clean
	$(RM) -f Makefile cfsndserv sounds soundsdef.h cfsndserv-alsa9 

clean::
	$(RM) -f alsa9.o

install:
	$(INSTALL) -d ${bindir}
	$(INSTALL) cfsndserv ${bindir}
	@for file in $(SOUND_TARGETS); do \
	    $(INSTALL) $$file ${bindir}; \
	    echo $(INSTALL) $$file ${bindir}; \
	done

depend:
	$(DEPEND) $(DEPENDFLAGS) -- $(CFLAGS) $(INCLUDES)  -- $(PROTOSOURCES) $(SOURCES)
